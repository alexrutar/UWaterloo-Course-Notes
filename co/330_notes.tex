% header -----------------------------------------------------------------------
% Template created by texnew (author: Alex Rutar); info can be found at 'https://github.com/alexrutar/texnew'.
% version (1.13)


% doctype ----------------------------------------------------------------------
\documentclass[11pt, a4paper]{memoir}
\usepackage[utf8]{inputenc}
\usepackage[left=3cm,right=3cm,top=3cm,bottom=4cm]{geometry}
\usepackage[protrusion=true,expansion=true]{microtype}


% packages ---------------------------------------------------------------------
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{graphicx}
\usepackage{etoolbox}

% Set enimitem
\usepackage{enumitem}
\SetEnumitemKey{nl}{nolistsep}
\SetEnumitemKey{r}{label=(\roman*)}

% Set tikz
\usepackage{tikz, pgfplots}
\pgfplotsset{compat=1.15}
\usetikzlibrary{intersections,positioning,cd}
\usetikzlibrary{arrows,arrows.meta}
\usetikzlibrary{shapes.geometric}
\tikzcdset{arrow style=tikz,diagrams={>=stealth}}
\tikzset{
    vtx/.style={inner sep=2pt,circle,fill=black},
    e/.style={thick},
    de/.style={e,decoration={markings,mark=at position 0.5 with {\arrow{>}}},postaction={decorate}}
}

% Set hyperref
\usepackage[hidelinks]{hyperref}
\usepackage{xcolor}
\newcommand\myshade{85}
\colorlet{mylinkcolor}{violet}
\colorlet{mycitecolor}{orange!50!yellow}
\colorlet{myurlcolor}{green!50!blue}

\hypersetup{
  linkcolor  = mylinkcolor!\myshade!black,
  citecolor  = mycitecolor!\myshade!black,
  urlcolor   = myurlcolor!\myshade!black,
  colorlinks = true,
}


% macros -----------------------------------------------------------------------
\DeclareMathOperator{\N}{{\mathbb{N}}}
\DeclareMathOperator{\Q}{{\mathbb{Q}}}
\DeclareMathOperator{\Z}{{\mathbb{Z}}}
\DeclareMathOperator{\R}{{\mathbb{R}}}
\DeclareMathOperator{\C}{{\mathbb{C}}}
\DeclareMathOperator{\F}{{\mathbb{F}}}

% Boldface includes math
\newcommand{\mbf}[1]{{\boldmath\bfseries #1}}

% proof implications
\newcommand{\imp}[2]{($#1\Rightarrow#2$)\hspace{0.2cm}}
\newcommand{\impe}[2]{($#1\Leftrightarrow#2$)\hspace{0.2cm}}
\newcommand{\impr}{{($\Rightarrow$)\hspace{0.2cm}}}
\newcommand{\impl}{{($\Leftarrow$)\hspace{0.2cm}}}

% align macros
\newcommand{\agspace}{\ensuremath{\phantom{--}}}
\newcommand{\agvdots}{\ensuremath{\hspace{0.16cm}\vdots}}

% convenient brackets
\newcommand{\brac}[1]{\ensuremath{\left\langle #1 \right\rangle}}
\newcommand{\norm}[1]{\ensuremath{\left\lVert#1\right\rVert}}
\newcommand{\abs}[1]{\ensuremath{\left\lvert#1\right\rvert}}

% arrows
\newcommand{\lto}[0]{\ensuremath{\longrightarrow}}
\newcommand{\fto}[1]{\ensuremath{\xrightarrow{\scriptstyle{#1}}}}
\newcommand{\hto}[0]{\ensuremath{\hookrightarrow}}
\newcommand{\mapsfrom}[0]{\mathrel{\reflectbox{\ensuremath{\mapsto}}}}
 
% Divides, Not Divides
\renewcommand{\div}{\bigm|}
\newcommand{\ndiv}{%
    \mathrel{\mkern.5mu % small adjustment
        % superimpose \nmid to \big|
        \ooalign{\hidewidth$\big|$\hidewidth\cr$/$\cr}%
    }%
}

% Convenient overline
\newcommand{\ol}[1]{\ensuremath{\overline{#1}}}

% Big \cdot
\makeatletter
\newcommand*\bigcdot{\mathpalette\bigcdot@{.5}}
\newcommand*\bigcdot@[2]{\mathbin{\vcenter{\hbox{\scalebox{#2}{$\m@th#1\bullet$}}}}}
\makeatother

% Big and small Disjoint union
\makeatletter
\providecommand*{\cupdot}{%
  \mathbin{%
    \mathpalette\@cupdot{}%
  }%
}
\newcommand*{\@cupdot}[2]{%
  \ooalign{%
    $\m@th#1\cup$\cr
    \sbox0{$#1\cup$}%
    \dimen@=\ht0 %
    \sbox0{$\m@th#1\cdot$}%
    \advance\dimen@ by -\ht0 %
    \dimen@=.5\dimen@
    \hidewidth\raise\dimen@\box0\hidewidth
  }%
}

\providecommand*{\bigcupdot}{%
  \mathop{%
    \vphantom{\bigcup}%
    \mathpalette\@bigcupdot{}%
  }%
}
\newcommand*{\@bigcupdot}[2]{%
  \ooalign{%
    $\m@th#1\bigcup$\cr
    \sbox0{$#1\bigcup$}%
    \dimen@=\ht0 %
    \advance\dimen@ by -\dp0 %
    \sbox0{\scalebox{2}{$\m@th#1\cdot$}}%
    \advance\dimen@ by -\ht0 %
    \dimen@=.5\dimen@
    \hidewidth\raise\dimen@\box0\hidewidth
  }%
}
\makeatother


% macros (theorem) -------------------------------------------------------------
\usepackage[thmmarks,amsmath,hyperref]{ntheorem}
\usepackage[capitalise,nameinlink]{cleveref}

% Numbered Statements
\theoremstyle{change}
\theoremindent\parindent
\theorembodyfont{\itshape}
\theoremheaderfont{\bfseries\boldmath}
\newtheorem{theorem}{Theorem.}[section]
\newtheorem{lemma}[theorem]{Lemma.}
\newtheorem{corollary}[theorem]{Corollary.}
\newtheorem{proposition}[theorem]{Proposition.}

% Claim environment
\theoremstyle{plain}
\theorempreskip{0.2cm}
\theorempostskip{0.2cm}
\theoremheaderfont{\scshape}
\newtheorem{claim}{Claim}
\renewcommand\theclaim{\Roman{claim}}
\AtBeginEnvironment{theorem}{\setcounter{claim}{0}}

% Un-numbered Statements
\theorempreskip{0.1cm}
\theorempostskip{0.1cm}
\theoremindent0.0cm
\theoremstyle{nonumberplain}
\theorembodyfont{\upshape}
\theoremheaderfont{\bfseries\itshape}
\newtheorem{definition}{Definition.}
\theoremheaderfont{\itshape}
\newtheorem{example}{Example.}
\newtheorem{remark}{Remark.}

% Proof / solution environments
\theoremseparator{}
\theoremheaderfont{\hspace*{\parindent}\scshape}
\theoremsymbol{$//$}
\newtheorem{solution}{Sol'n}
\theoremsymbol{$\blacksquare$}
\theorempostskip{0.4cm}
\newtheorem{proof}{Proof}
\theoremsymbol{}
\newtheorem{nmproof}{Proof}

% Format references
\crefformat{equation}{(#2#1#3)}
\Crefformat{theorem}{#2Thm. #1#3}
\Crefformat{lemma}{#2Lem. #1#3}
\Crefformat{proposition}{#2Prop. #1#3}
\Crefformat{corollary}{#2Cor. #1#3}
\crefformat{theorem}{#2Theorem #1#3}
\crefformat{lemma}{#2Lemma #1#3}
\crefformat{proposition}{#2Proposition #1#3}
\crefformat{corollary}{#2Corollary #1#3}


% macros (algebra) -------------------------------------------------------------
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\chr}{char}
\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\disc}{disc}
\DeclareMathOperator{\End}{End}
\DeclareMathOperator{\Fix}{Fix}
\DeclareMathOperator{\Frac}{Frac}
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\GL}{GL}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Nil}{Nil}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\Res}{Res}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\spn}{span}
\DeclareMathOperator{\Stab}{Stab}
\DeclareMathOperator{\Tor}{Tor}

% Lagrange symbol
\newcommand{\lgs}[2]{\ensuremath{\left(\frac{#1}{#2}\right)}}

% Quotient (larger in display mode)
\newcommand{\quot}[2]{\mathchoice{\left.\raisebox{0.14em}{$#1$}\middle/\raisebox{-0.14em}{$#2$}\right.}
                                 {\left.\raisebox{0.08em}{$#1$}\middle/\raisebox{-0.08em}{$#2$}\right.}
                                 {\left.\raisebox{0.03em}{$#1$}\middle/\raisebox{-0.03em}{$#2$}\right.}
                                 {\left.\raisebox{0em}{$#1$}\middle/\raisebox{0em}{$#2$}\right.}}


% macros (analysis) ------------------------------------------------------------
\DeclareMathOperator{\M}{{\mathcal{M}}}
\DeclareMathOperator{\B}{{\mathcal{B}}}
\DeclareMathOperator{\ps}{{\mathcal{P}}}
\DeclareMathOperator{\pr}{{\mathbb{P}}}
\DeclareMathOperator{\E}{{\mathbb{E}}}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\sgn}{sgn}

\renewcommand{\Re}{\ensuremath{\operatorname{Re}}}
\renewcommand{\Im}{\ensuremath{\operatorname{Im}}}
\renewcommand{\d}[1]{\ensuremath{\operatorname{d}\!{#1}}}


% file-specific preamble -------------------------------------------------------
\DeclareMathOperator{\Inv}{Inv}
\DeclareMathOperator{\inv}{inv}
\DeclareMathOperator{\OB}{OB}
\newcommand{\sqbinom}[2]{\begin{bmatrix}#1\\#2\end{bmatrix}}


% constants --------------------------------------------------------------------
\newcommand{\subject}{REPLACE}
\newcommand{\semester}{REPLACE}


% formatting -------------------------------------------------------------------
% Fonts
\usepackage{kpfonts}
\usepackage{dsfont}

% Adjust numbering
\numberwithin{equation}{section}
\counterwithin{figure}{section}
\counterwithout{section}{chapter}
\counterwithin*{chapter}{part}

% Footnote
\setfootins{0.5cm}{0.5cm} % footer space above
\renewcommand*{\thefootnote}{\fnsymbol{footnote}} % footnote symbol

% Table of Contents
\renewcommand{\thechapter}{\Roman{chapter}}
\renewcommand*{\cftchaptername}{Chapter } % Place 'Chapter' before roman
\setlength\cftchapternumwidth{4em} % Add space before chapter name
\cftpagenumbersoff{chapter} % Turn off page numbers for chapter
\maxtocdepth{section} % table of contents up to section

% Section / Subsection headers
\setsecnumdepth{section} % numbering up to and including "section"
\newcommand*{\shortcenter}[1]{%
    \sethangfrom{\noindent ##1}%
    \Large\boldmath\scshape\bfseries
    \centering
\parbox{5in}{\centering #1}\par}
\setsecheadstyle{\shortcenter}
\setsubsecheadstyle{\large\scshape\boldmath\bfseries\raggedright}

% Chapter Headers
\chapterstyle{verville}

% Page Headers / Footers
\copypagestyle{myruled}{ruled} % Draw formatting from existing 'ruled' style
\makeoddhead{myruled}{}{}{\scshape\subject}
\makeevenfoot{myruled}{}{\thepage}{}
\makeoddfoot{myruled}{}{\thepage}{}
\pagestyle{myruled}
\setfootins{0.5cm}{0.5cm}
\renewcommand*{\thefootnote}{\fnsymbol{footnote}}

% Titlepage
\title{\subject}
\author{Alex Rutar\thanks{\itshape arutar@uwaterloo.ca}\\ University of Waterloo}
\date{\semester\thanks{Last updated: \today}}

\begin{document}
\pagenumbering{gobble}
\hypersetup{pageanchor=false}
\maketitle
\newpage
\frontmatter
\hypersetup{pageanchor=true}
\tableofcontents*
\newpage
\mainmatter


% main document ----------------------------------------------------------------
\chapter{REPLACE}
\begin{enumerate}
    \item For $a,b,k\in\N$,
        \begin{equation}\label{e:van}
            \binom{a+b}{k} = \sum_{j=1}^k\binom{a}{j}\cdot\binom{b}{k-j}
        \end{equation}
        We prove this with a bijection:
        \begin{equation*}
            \mathcal{B}(a+b,k) \leftrightharpoons \bigcup_{j=0}^k\mathcal{B}(a,j)\times\mathcal{B}(b,k-j)
        \end{equation*}
        given by $S\mapsto (S\cap\{1,\ldots,a\},(S\cap\{a+1,\ldots,a+b\})^{(-a)}$ and $(P,Q)\mapsto P\cup Q^{(a)}$, where $\mathcal{B}(n,i)$ is the set of $i-$element subsets of $\{1,2,\ldots,n\}$ and for $C\subseteq\Z$ and $q\in\Z$, $C^{(q)}=\{c+q:c\in C\}$.
        Note that the equation in fact gives the polynomial identity
        \begin{equation*}
            \binom{x+y}{k}=\sum_{j=0}^k\binom{x}{j}\binom{y}{k-j}
        \end{equation*}
        in $\Q[x,y]$.
        We denote the falling factorial $(x)_i=x(x-1)(x-2)\cdots(x-i+1)$, which has degree $i$ for each $i\in\N$.
        In particular, $(x)_i=i!\binom{x}{i}$, so multiplying our identity by $k!$, we get
        \begin{equation*}
            (x+y)_k=\sum_{j=0}^k\binom{k}{j}(x)_j(y)_{k-j}
        \end{equation*}
        Compare this with the standard binomial theorem
        \begin{equation*}
            (x+y)^k=\sum_{j=0}^k\binom{k}{j}x^jy^{k-j}
        \end{equation*}
        These are called sequences of binomial type.
    \item Here's another identity.
        For $n\geq 0$ and $s,t\geq 1$,
        \begin{equation*}
            \binom{n+s+t-1}{s+t-1}=\sum_{k=0}^n\binom{k+s-1}{s-1}\binom{n-k+t-1}{t-1}
        \end{equation*}
        Let $\mathcal{M}(m,r)$ denote a multiset of size $m$ with elements of $r$ types, so that $|\mathcal{M}(m,r)|=\binom{m+r-1}{r-1}$.
        Let's define a bijection
        \begin{equation}\label{e:po1}
            \mathcal{M}(n,s+t)\rightleftharpoons\bigcup_{k=1}^n\mathcal{M}(k,s)\times\mathcal{M}(n-k,t)
        \end{equation}
        $\mu=(m_1,\ldots,m_{s+t})\mapsto ((m_1,\ldots,m_s),(m_{s+1},\ldots,m_{s+t}))$ and $(\nu,\theta)\mapsto \nu\theta$.
        Note that if $f,g$ are polynomials of degree $d$ and $e$ respectively, then $\sum_{k=0}^nf(k)g(n-k)$ is a polynomial in $n$ of degree $d+e-1$.

        Is there some way to understand  \cref{e:po1}?
        It is unclear, with our known techniques, that this corresponds to a polynomial identity since there is a variable $n$ in the exponent.
        However, we can use generating functions.
        Define
        \begin{align*}
            \sum_{n=0}^\infty\binom{n+s+t-1}{s+t-1}z^n &= \sum_{n=0}^\infty|\mathcal{M}(n,s+t)|z^n= \sum_{(m_1,\ldots,m_{s+t})}z^{m_1+\cdots+m_{s+t}}\\
                                                       &= \left(\sum_{m=0}^\infty z^m\right)^{s+t}\\
                                                       &= \frac{1}{(1-z)^{s+t}}=\frac{1}{(1-z)^s}\frac{1}{(1-z)^t}\\
                                                       &= \sum_{k=0}^\infty\binom{k+s-1}{s-1}z^k\sum_{\ell=0}^\infty\binom{\ell+t-1}{t-1}z^\ell\\
                                                       &= \sum_{n=0}^\infty z^n\left(\sum_{k=0}^n\binom{k+s-1}{s-1}\binom{n-k+t-1}{t-1}\right)
        \end{align*}
        Similarly, \cref{e:van} is equivalent to saying $(1+z)^{a+b}=(1+z)^a(1+z)^b$.
        Note that $(1+z)^n=\sum_{k=0}^n\binom{n}{k}z^k=\sum_{k=0}^\infty\binom{n}{k}z^k$ for $n\in\N$.

        Can we substitute $\frac{1}{(1-q)^t}=(1+z)^n$ where $z=-q$ and $n=-t$?
    \item Consider
        \begin{equation*}
            (x_1+x_2)^n = \sum_{i=0}^n\binom{n}{i}x_1^ix_2^{n-i}
        \end{equation*}
        and
        \begin{equation*}
            (x_1+x_2)^n = \sum_{f:N_n\to\{1,2\}}\prod_{j=1}^n x_{f(j)}
        \end{equation*}
        More generally, we can consider
        \begin{equation*}
            (x_1+\cdots+x_k)^n = \sum_{f:N_n\to N_k}\prod_{j\in N_n}x_{f(j)}
        \end{equation*}
        If we set all $x_1=\cdots=x_k=1$, then $k^n$ gives the number of functions from $N_n$ to $N_k$.
        If we set $x_i=q^i$ for all $i\in N_k$, then we get
        \begin{equation*}
            \left(\frac{q-q^{k+1}}{1-q}\right)^n =(q+q^2+\cdots+q^k)^n = \sum_{f:N_n\to N_k}q^{f(1)+\cdots+f(k)}
        \end{equation*}
        Collect all the terms in $(x_1+\cdots+x_k)^n$ that produce the same monomial.
        Given a multiset $\mu$ with $m_1+\cdots+m_k=n$, write $x_1^{m_1}\cdots x_k^{m_k}=\underline{x}^\mu$.
        Then
        \begin{equation*}
            (x_1+\cdots+x_k)^n =\frac{n!}{m_1!\cdots m_k!}\underline{x}^\mu= \sum_{\mu\in \mathcal{M}(n,t)}\binom{n}{\mu}\underline{x}^\mu
        \end{equation*}

    \item How can we interpret
        \begin{equation*}
            P_n(q)=\prod_{i=1}^n(1+q+q^2+\cdots+q^{i-1})
        \end{equation*}
        In general, if we set $q=1$, we see that $P_n(1)=n!$.
        We might hope that there is some weight function on permutations $w:\mathcal{S}_n\to\N$ such that $P_n(q)=\sum_{\sigma\in\mathcal{S}_n}q^{w(\sigma)}$.
        Recall the bijection $I_n:\mathcal{S}_n\to\mathcal{Q}_n$ from chapter 1.
        Let's find some weight function $\nu:\mathcal{Q}_n\to\N$ such that $\sum_{\rho\in\mathcal{Q}_n}x^{\nu(\rho)}=P_n(q)$, then ``pull back'' the definition of $\nu:\mathcal{Q}_n\to\N$ to get a definition for $\omega:\mathcal{S}_n\to\N$.
        Note that $\sum_{h\in N_r}q^{h-1}=1+q+\cdots+q^{r-1}$.
        Thus
        \begin{equation*}
            \sum_{\rho=(h_1,\ldots,h_n)\in\mathcal{Q}_n}q^{(h_1-1)+(h_2-1)+\cdots+(h_n-1)} = \prod_{i=1}^n(1+q+\cdots+q^{i-1})=P_n(q)
        \end{equation*}
        so we can define $\nu(\rho)=|\rho|-n$ and $\sum_{q\in\mathcal{Q}_n}q^{|\rho|-n}=P_n(q)$.
        We also have
        \begin{equation*}
            \sum_{\rho\in\mathcal{Q}_n}q^{(h_1-1)+\cdots+(h_n-1)} = (1+q+\cdots+q^{n-1})(1+q+\cdots+q^{n-2})\cdots(1+q)(1)
        \end{equation*}
        For notation, define $[m]_q=1+q+\cdots+q^{m-1}=\frac{1-q^m}{1-q}$.
        Then $[m]_q!=[m]_q[m-1]_q\cdots[1]_q$.
        \begin{equation*}
            \begin{array}{c|cccccc}
                &1&q&q^2&q^3&q^4\\
                \hline
                q[3]_q & 0&1&1&1\\
                \hline
                [2]_q[3]_q & 1&2&2&1\\
                -q[2]_q[3]_q & 0&-1&-2&-2&-1\\
                q^2[2]_q[3]_q & 0&0&1&2&2&1\\
                \hline
                [6]_q & 1&1&1&1&1&1
            \end{array}
        \end{equation*}
        so that $[6]_q=(1-q+q^2)[2]_q[3]_q$.
        An \textbf{inversion} in $\sigma=a_1\ldots a_n\in\mathcal{S}_n$ is a pair $(i,j)$ of indices $1\leq i<j\leq n$ with $a_i>a)j$.
        Define $\Inv(\sigma)$ as the set of inversions of $\sigma$, and $\inv(\sigma)=|\Inv(\sigma)|$.
        Notice that if $\sigma=a_1\ldots a_n\mapsto\rho=(h_1,\ldots,h_n)$, then for each $1\leq i\leq n$, $h_i-1$ is the number of inversions of $\sigma$ with $i$ in the first coordinate.
        Recall
        \begin{align*}
            \mathcal{S}_n&\leftrightharpoons\mathcal{B}(n,k)\times\mathcal{S}_k\times\mathcal{S}_{n-k}\\
            \sigma=a_1\ldots a_n&\leftrightarrow (A,\beta,\gamma)\\
            \inv(\sigma) &= w(A)+\inv(\beta)+\inv(\gamma)
        \end{align*}
        Assuming such a weight fuction $w(A)$ exists, then
        \begin{align*}
            [n]!_q&=\sum_{\sigma\in\mathcal{S}_n}q^{\inv(\sigma)} =\sum_{(A,\beta,\gamma)}q^{w(A)+\inv(\beta)+\inv(\gamma)}\\
                  &= [k]!_q\cdot[n-k]!_q\cdot\sum_{A\in\mathcal{B}(n,k)}q^{w(A)}
        \end{align*}
        so that
        \begin{equation*}
            \sum_{A\in\mathcal{B}(n,k)}q^{w(A)}=\frac{[n]!_q}{[k]!_q\cdot[n-k]!_q}=\sqbinom{n}{k}_q
        \end{equation*}
\end{enumerate}
\begin{equation*}
    \sum_{S\in\mathcal{B}(n,k)} q^{\text{sum}(S)} = q^{\binom{k+1}{2}}\sqbinom{n}{k}_q
\end{equation*}
\begin{theorem}
    Let $V$ be an $n-$dimensional vector space over a finite field $\F_q$.
    Then for $0\leq k\leq n$, the number of $k-$dimensional subspaces of $V$ is $\sqbinom{n}{k}_q$.
\end{theorem}
\begin{lemma}
    Let $L:V\to W$ be a linear transformation that is surjective.
    Then $\dim V=\dim W+\dim(\ker L)$.
    So if this is over a finite field $\R_q$, every $w\in W$ is the image of exactly $q^{\dim(\ker(L)}$ vectors $v\in V$.
\end{lemma}
For every $w\in W$, is the image of exactly $q^k$ vectors in $V$.
The number of ordered bases of $V$ is $q^{\binom{n}{2}}(q-1)^n[n]!_q$.
\begin{theorem}
    Let $V$ be an $n-$dimensional vector space over a finite field $\F_q$.
    For $0\leq k\leq n$, the number of $k-$dimensional subspaces of $V$ is $\sqbinom{n}{k}_q$.
\end{theorem}
\begin{proof}
    Let $\OB(V)$ be the set of ordered bases of $V$, and let $G(V,k)$ be the set of $k-$dimensional subspaces of $V$.
    Define a function
    \begin{equation*}
        \OB(V)\to\bigcup_{U\in G(V,k)}\left(\{U\}\times\OB(U)\times\OB(V/U)\right)
    \end{equation*}
    as follows.
    Given $(v_1,\ldots,v_n)$ an ordered basis of $V$, let $U=\spn_{\F_q}\{v_1,\ldots,v_k\}$.
    Then $(v_1,\ldots,v_k)\in\OB(U)$ and $(v_{k+1}+U,\ldots,v_n+U)\in\OB(V/U)$.
    Consider the map $L:V\to V/U$ given by $L(v)=v+U$, so that every $v+U$ in $V/U$ is the image of $q^k$ vectors in $V$.
    Thus $(v_{k-1}+U,\ldots,v_n+U)$ is the image of $q^{k(n-k)}$ sequences $(z_{k+1},\ldots,z_n)$ of vectors in $V$.
    Thus the function $(v_1,\ldots,v_n)\mapsto(U,(v_1,\ldots,v_k),(v_{k+1}+U,\ldots,v_n+U))$ is surjective and hits everything on the RHS $q^{k(n-k)}$ times.
    But then counting both sides,
    \begin{align*}
        q^{\binom{n}{2}}(q-1)^n[n]!_q &= \sum_{U\in G(V,k)}1\cdot q^{\binom{k}{2}}(q-1)^k[k]!_q\cdot q^{\binom{n-k}{2}}(q-1)^{n-k}[n-k]!_q\cdot q^{k(n-k)}\\
        q^{\binom{n}{2}}[n]!_q &= |G(V,k)|\cdot[k]!_q\cdot[n-k]!_q q^{\binom{k}{2}+\binom{n-k}{2}+k(n-k)}\\
        [n]!_q &= |G(V,k)|\cdot[k]!_q\cdot[n-k]!_q
    \end{align*}
    giving our desired result.
\end{proof}
A \textbf{set partition} $\pi$ of a set $V$ is a collection of subsets $\pi=\{B_1,\ldots,B_k\}$ of $V$ such that
\begin{itemize}[nl]
    \item Each $B_i$ is not empty
    \item $B_i\cap B_j=\emptyset$ if $i\neq j$
    \item $B_1\cup\cdots\cup B_k=V$
\end{itemize}
Let $\Pi(n,k)$ be the set of set partitions of $N_n$ with $k$ blocks, and set $S(n,k)=|\Pi(n,k)|$.
Certainly $S(0,0)=1$ for the empty set partition.
If $n\geq 1$, then $S(n,0)=0$, $S(n,n)=1$, and $S(n,1)=1$.
We can also define a recurrence relation.
Let $\Pi'(n,k)$ be those $\pi\in\Pi(n,k)$ in which $\{n\}$ is a block, and $\Pi''(n,k)$ is the set of $\pi$ in which $n$ is in a block of size at least 2.
Note that $\Pi'(n,k)\leftrightharpoons\Pi(n-1,k-1)$ by removing or adding the independent element.
Furthemore, the function which removes the element $n$ from a block in $\Pi''(n,k)$ is a surjective function onto $\Pi(n-1,k)$ which hits every element of $\Pi(n-1,k)$ $k$ times.
Thus combing these observations, $S(n,k)=S(n-1,k-1)+k\cdot S(n-1,k)$.
Thus we can compute
\begin{equation*}
    \begin{array}{c|c|c|c|c|c|c|c}
        S(n,k) & 0 & 1 & 2 & 3 & 4 & 5 & 6\\
        \hline
        0 & 1 & X & X & X & X & X & X\\
        \hline
        1 & 0 & 1 & X & X & X & X & X\\
        \hline
        2 & 0 & 1 & 1 & X & X & X & X\\
        \hline
        3 & 0 & 1 & 3 & 1 & X & X & X\\
        \hline
        4 & 0 & 1 & 7 & 6 & 1 & X & X\\
        \hline
        5 & 0 & 1 & 15& 25& 10& 1 & X\\
        \hline
        6 & 0 & 1 & 31&  & 1\\
    \end{array}
\end{equation*}
From homework 2, we have that
\begin{equation*}
    x^n=\sum_{k=0}^n k! S(n,k)\binom{n}{k}
\end{equation*}
Invert this using Binomial Inversion.
\begin{theorem}[Binomial Inversion]
Let $a_0,a_1,\ldots$ be a sequence.
\end{theorem}
\begin{proof}
    For $h\in\N$, let $b_h=\sum_{i=0}^h\binom{h}{i}a_i$.
    Let $A(t)=\sum_{i=0}^\infty a_it^i$ and $B(t)=\sum_{h=0}^\infty b_ht^h$.
    Then
    \begin{align*}
        B(t) &= \sum_{h=0}^\infty t^h\sum_{i=0}^h\binom{h}{i}a_i\\
             &= \sum_{i=0}^\infty a_it^i\sum_{h=i}^\infty\binom{h}{h-i}t^{h-i}\\
             &= \sum_{i=0}^\infty a_it^i\sum_{j=0}^\infty\binom{i+j}{j}t^j=\sum_{i=0}^\infty\frac{a_it^i}{(1-t)^{i+1})}\\
             &= \frac{1}{1-t}\sum_{i=0}^\infty a_i\left(\frac{t}{1-t}\right)^i=\frac{1}{1-t}A\left(\frac{t}{1-t}\right)
    \end{align*}
    Let $z=t/(1-t)$, so that $t=z/(1+z)$.
    Thus
    \begin{equation*}
        B\left(\frac{z}{1+z}\right)=(1+z)A(z)
    \end{equation*}
    so that
    \begin{align*}
        \sum_{i=0}^\infty a_iz^i &= \frac{1}{1+z}B\left(\frac{z}{1+z}\right) = \sum_{h=0}^\infty b_h\frac{z^h}{(1+z)^{h+1}}\\
                                &= \sum_{h=0}^\infty b_h\sum_{j=0}^\infty\binom{j+h}{h}z^{h}(-z)^j\\
                                &= \sum_{n=0}^\infty z^n\sum_{j=0}^\infty\binom{n}{j}(-1)^{n-j}b_{j}
    \end{align*}
    Thus for all $m\in\N$, $a_m=\sum_{j=0}^m\binom{m}{j}(-1)^{m-j}b_j$.
\end{proof}
In particular, applying this to Stirling numbers of the second kind, for all $n\in\N$ in $\R[x]$, we have
\begin{equation*}
    x^n=\sum_{k=0}^n S(n,k)\binom{x}{k}k!
\end{equation*}
Let $b_i=i^n$ for $i=0,1,2,\ldots$.
If $k>n$ or $k>i$, then $S(n,k)\binom{i}{k}=0$; thus,
\begin{align*}
    i^n &= \sum_{k=0}^nS(,nk)\binom{i}{k}k! = \sum_{k=0}^{\min(n,i)}S(n,k)\binom{i}{k}k!=\sum_{k=0}^i S(n,k)\binom{i}{k}k!\\
        &= \sum_{k=0}^i\binom{i}{k}a_k
\end{align*}
where $a_k=k!S(n,k)$ for all $k\in\N$.
But then apply binomial inversion to get
\begin{equation*}
    a_k=\sum_{j=0}^k\binom{k}{j}(-1)^{k-j}b_j
\end{equation*}
Suppose $m^n=\sum_{k=0}^n S(n,k)\binom{m}{k}k!$.
Then $[m]_q^n=\sum_{k=0}^\infty S[n,k]_q\sqbinom{m}{k}_q[k]!_q$, where $S[n,k]_q=\sum_{\pi\in\Pi(n,k)}q^{w(\pi)}$.
Is there some function $w:\Pi(n,k)\to\N$ that makes this work?
\begin{enumerate}
    \item[B.5] For $\mathcal{S}$ a set of BTs, let $\mathcal{R}$ be the trees in $\mathcal{S}$ with a red root and $\mathcal{B}$ be the trees in $\mathcal{S}$ with a blue root, so $\mathcal{S}=\mathcal{R}\cupdot\mathcal{B}$ disjointly.
        Let $r(T)$ count the number of red notes, and $b(T)$ count the number of blue nodes, and let $S(x,y)=\sum_{T\in\mathcal{S}}x^{r(T)}y^{b(T)}$.
        In particular, $S(t,t)=\sum_{T\in\mathcal{S}}t^{n(T)}$ where $n(T)=r(T)+b(T)$ is the total number of notes.

        We have bijections
        \begin{align*}
            \mathcal{R} &\leftrightharpoons \{{\color{red}\bullet}\}\times\bigcup_{k=0}^\infty\mathcal{S}^k\\
            \mathcal{B} &\leftrightharpoons\{{\color{blue}\bullet}\}\times\bigl((\epsilon\cup\mathcal{R})(\mathcal{B}\mathcal{R})^*(\epsilon\cup\mathcal{B})\bigr)\\
            \mathcal{S} &\leftrightharpoons\mathcal{R}\cup\mathcal{B}
        \end{align*}
        so that
        \begin{align*}
            S&=R+B\\
            R &= \frac{x}{1-S}\\
            B &= y(1+R)\frac{1}{1-BR}(1+B)
        \end{align*}
        Substituting $R$ and $B$ using the first two equations, we get
        \begin{equation*}
            S-\frac{x}{1-S}=\frac{y\left(1+\frac{x}{1-S}\right)\left(1+S-\frac{x}{1-S}\right)}{1-\frac{x}{1-S}\left(S-\frac{x}{1-S}\right)}
        \end{equation*}
        \begin{center}
            \begin{tikzpicture}[btree/.style={draw=black,regular polygon, regular polygon sides=3,rounded corners}]
                \node[vtx,fill=red,draw=black] (v) at (2,2) {};
                \node[btree] (b1) at (0,0) {$S_1$};
                \node[btree] (b2) at (2,0) {$S_2$};
                \node[draw=none] (eps) at (3.5,0) {$\cdots$};
                \node[btree] (b3) at (5,0) {$S_n$};
                \draw (v) -- ([yshift=-0.087cm]b1.north);
                \draw (v) -- ([yshift=-0.087cm]b2.north);
                \draw (v) -- ([yshift=-0.087cm]b3.north);
            \end{tikzpicture}
        \end{center}
        \begin{center}
            \begin{tikzpicture}[btree/.style={draw=black,regular polygon, regular polygon sides=3,rounded corners}]
                \node[vtx,fill=blue,draw=black] (v) at (2,2) {};
                \node[btree,fill=blue,fill opacity=0.1,text opacity=1] (b1) at (0,0) {$S_1$};
                \node[btree,fill=red,fill opacity=0.1,text opacity=1] (b2) at (2,0) {$S_2$};
                \node[draw=none] (eps) at (3.5,0) {$\cdots$};
                \node[btree,fill=blue,fill opacity=0.1,text opacity=1] (b3) at (5,0) {$S_n$};
                \draw (v) -- ([yshift=-0.087cm]b1.north);
                \draw (v) -- ([yshift=-0.087cm]b2.north);
                \draw (v) -- ([yshift=-0.087cm]b3.north);
            \end{tikzpicture}
        \end{center}
\end{enumerate}
\chapter{Power Series Identities}
\begin{enumerate}[nl,r]
    \item $\displaystyle\frac{1}{(1-z)^h}=\sum_{k=0}^\infty\binom{k+h-1}{h-1}z^k$
    \item Let $a_0,a_1,\ldots$ be a sequence, and $b_h=\sum_{i=0}^h\binom{h}{i}a_i$.
        Then $a_m=\sum_{i=0}^m\binom{m}{i}(-1)^{m-i}b_i$.
    \item General Binomial Series.
        For $k\in\N$, let $\binom{y}{k}=\frac{y(y-1)\cdots(y-k+1)}{k!}\in\Q[y]$.
        Then we define
        \begin{equation*}
            (1+x)^y=\sum_{k=0}^\infty\binom{y}{k}x^k
        \end{equation*}
        which is a power series in $x$.
        Each coefficient of $[x^n]$ is in $\Q[y]$.
        Then by Vandermone convolution,
        \begin{align*}
            (1+x)^y(1+x)^z&=\sum_{i=0}^\infty\binom{y}{i}x^i\sum_{j=0}^\infty\binom{z}{j}x^j\\
                          &=\sum_{n=0}^\infty x^n\left(\sum_{i=0}^n\binom{y}{i}\binom{z}{n-i}\right)\\
                          &= \sum_{n=0}^\infty\binom{y+z}{n}x^n=(1+x)^{y+z}
        \end{align*}
        Furthermore, if $y=-p<0$ is an integer, then
        \begin{align*}
            (1+x)^{-p}&=\sum_{k=0}^\infty\binom{-p}{k}x^k\\
                      &=\sum_{k=0}^\infty\binom{k+p-1}{p-1}
        \end{align*}
        For $\alpha\in\C$, $f(x)=(1+x)^\alpha$ is analytic for $|x|<1$.
        In particular, by Taylor's theorem,
        \begin{equation*}
            (1+x)^\alpha=\sum_{k=0}^\infty c_kx^k
        \end{equation*}
        where $c_k=\frac{1}{k!}\frac{d^k}{dx^k}(1+x)^\alpha|_{x=0}$.
\end{enumerate}
Consider the class $\mathcal{Q}$ of (unrooted) tres in which every vertex has odd degree.
We identify $\mathcal{Q}^\bullet\equiv\chi *\xi_{\text{odd}}[\mathcal{N}]$ for some class $\mathcal{N}$ describing the components of $T\setminus \{v\}$.
A structure in $\mathcal{N}$ is a rooted tree in which every vertex has an even number of children.
Moreover, $\mathcal{N}\equiv\chi *\xi_{\text{even}}[\mathcal{N}]$.
Note that the exponential generating function for $\xi_{\text{odd}}$ is $\sum_{j=0}^\infty\frac{e^{2j+1}}{(2j+1)!}$, and similarly for the even components.
This give
\begin{align*}
    \mathcal{Q}^\bullet &= x\cdot E_{\text{odd}}(N(x))=x\cdot\sinh(N(x))\\
    N(x) &= x\cdot E_{\text{even}}(N(x))=x\cdot\cosh(N(x))\\
\end{align*}
Now apply LIFT with $K=\Q$, $G(u)=\cosh(u)$, and $F(u)=\sinh(u)$, so $F'(u)=\cosh(u)$.
Now for $n\geq 2$,
\begin{align*}
    |\mathcal{Q}_n|&=\frac{1}{n}|\mathcal{Q}^\bullet_n|=\frac{1}{n}\cdot n![x^n]Q^\bullet(x)\\
                   &= (n-1)![x^n]x\sinh(N(x))\\
                   &= (n-1)![x^{n-1}]\sinh(N(x))\\
                   &= (n-1)!\cdot\frac{1}{n-1}[u^{n-2}]F'(u)G(u)^{n-1}\\
                   &= (n-2)!\cdot[u^{n-2}]\cosh(u)^n\\
                   &= (n-2)![u^{n-2}]\left(\frac{e^u+e^{-u}}{2}\right)^n\\
                   &= \frac{(n-2)!}{2^n}[u^n]\sum_{j=0}^n\binom{n}{j}(e^u)^j(e^{-u})^{n-j}\\
                   &= \frac{(n-2)!}{2^n}[u^{n-2}]\sum_{j=0}^n\binom{n}{j}e^{(2j-n)u}\\
                   &= \frac{(n-2)!}{2^n}\sum_{j=0}^n\binom{n}{j}[u^{n-2}]\sum_{i=0}^\infty\frac{((2j-n)u)^i}{i!}\\
                   &= \frac{(n-2)!}{2^n}\sum_{j=0}^n\binom{n}{j}\frac{(2j-n)^{n-2}}{(n-2)!}\\
                   &= \frac{1}{2^n}\sum_{j=0}^n\binom{n}{j}(2j-n)^{n-2}
\end{align*}
If $n$ is odd, then this summation is zero, as expected.
\subsection{Endofunctions}
An \textbf{endofunction} is any function $\phi:X\to X$.
If $|X|=n$, then there are $n^n$ endofunctions $\phi:X\to X$.
Call this class $\mathcal{F}$.
We can define the \textbf{functional directed graph} of $\phi:X\to X$ with vertices $X$ and directed edges $v\to\phi(v)$ for $v\in X$.
When we say $\phi$ is connected, we mean the underlying undirected graph is connected.
Call this class $\mathfrak{C}$.
Certainly $\mathcal{F}\equiv\xi[\mathfrak{C}]$.

What is the expected number of components among all $n^n$ endofunctions on $\{1,2,\ldots,n\}$?
Certainly $F(x)=\exp(C(x))$ for the EGFs $F(x)$ and $C(x)$ for $\mathcal{F}$ and $\mathfrak{C}$ respectively.
Let $c(\phi)$ be the number of connected components of $\phi\in\mathcal{F}_X$.
Then
\begin{equation*}
    F(x,y) = \sum_{n=0}^\infty\left(\sum_{\phi\in\mathcal{F}_n}y^{c(\phi)}\right)\frac{x^n}{n!}
\end{equation*}
Recall $F(x)=\sum_{k=0}^\infty\frac{C(x)^k}{k!}$, where $C(x)^k$ is the generating function for a graph with $k$ connected components.
Thus
\begin{equation*}
    F(x,y)=\sum_{k=0}^\infty\frac{(C(x)y)^k}{k!}=\exp(yC(x))
\end{equation*}

Let's determine the structure of a connected endofunction $\phi\in\mathfrak{C}_X$.
By following arrows, the graph must contain a directed cycle; in fact, this directed cycle must be unique.
The same argument allows use to decompose the graph into a set of components, one for each vertex in the directed cycle.
But then each component is in fact a rooted tree.
We can thus identify $\mathfrak{C}\equiv\mathcal{C}[\mathcal{R}]$ where $\mathcal{R}=\mathcal{T}^\bullet$ is the class of rooted trees and $\mathcal{C}$ is the class of cyclic permutations.
Passing to EGFs, we have
\begin{align*}
    F(x,y) &= \exp(yC(x))\\
    C(x) &= \log\left(\frac{1}{1-R(x)}\right)\\
    R(x) &= x\exp(R(x))
\end{align*}
Thus,
\begin{equation*}
    F(x,y)=\exp\left(\log\left(\left(\frac{1}{(1-R(x))}\right)^y\right)\right)=\left(\frac{1}{1-R(x)}\right)^y
\end{equation*}
Apply LIFT with $R(x)=x\exp(R(x))$, $G(u)=\exp(u)$, $F(u)=\frac{1}{(1-u)^y}$.
Then $F'(u)=\prt{}{u}F(u)=\frac{y}{(1-u)^{y+1}}$
Thus the total number of components among all $n^n$ $\phi\in\mathcal{F}_n$ is
\begin{align*}
    n![x^n]\prt{}{y}F(x,y)|_{y=1} &= \left.n!\prt{}{y}\frac{1}{n}[u^{n-1}]\frac{y}{(1-u)^{y+1}}\exp(u)^n\right|_{y=1}\\
                                  &=(n-1)![u^{n-1}]\exp(nu)\left[\frac{(1-u)^{y+1}-y(y+1)(1-u)^y}{(1-u)^{2y+2}}\right]_{y=1}\\
                                  &=(n-1)![u^{n-1}]\exp(nu)\left[\frac{(1-u)^{2}-2(1-u)}{(1-u)^{4}}\right]
\end{align*}
\end{document}


